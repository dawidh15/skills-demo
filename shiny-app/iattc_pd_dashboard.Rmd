---
title: "IATTC Public Domain Data"
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    theme: 
      bootswatch: united
    logo: logo.png
    favicon: logo.png
---

# Page 1 {data-orientation=rows}

```{r setup, include=FALSE, context = "server"}
library(flexdashboard)
library(shiny)
library(skillsTools) #loads tidyverse, fs, RSQlite
library(dygraphs)
# library(leaflet)
# bslib::bs_themer() # Activates Theme selection tool
# thematic::thematic_rmd() # set ggplot in theme colors

# ------------CACHE----------------
# Store cache on disk, is persistent across R processes
# Otherwise, cache is stored in memory
# See https://shiny.rstudio.com/articles/caching.html
#shinyOptions(cache = cachem::cache_disk(file.path(dirname(tempdir()), "myapp-cache")))
shinyOptions(cache = cachem::cache_disk(path_join(c(".","appCache"))))

dat_sp_catch_by_spp <- GetTable(".", "General Spatial Data")
dat_spp_time <- GetTable(".", "Catch Time Series")
dat_prop_ctch <- GetTable(table_name = "Proportional Catches by Period-Flag")

```

## Column {.sidebar data-width=200}

```{r}
selectInput("selectedSpp"
            , label = "Select a species"
            , choices = skillsTools::GetSppNames(".")
            , multiple = FALSE
            , selected = "ALL")

actionButton("submitP1", label = "Apply", icon = icon("filter"))
```


## Row  {data-height=300}

### Instructions

- Hola
- Mundo

### Historical catches by species

```{r}
# Get spp from input when Apply button is pressed
# add ignoreNULL = FALSE, this allows to use the default selected value for the input
#this_spp <- eventReactive(input$submitP1, valueExpr = input$selectedSpp,ignoreNULL = FALSE)

```


```{r}
fillCol(
  plotOutput( "HistoricalCatchMap", height = "100%" )
)
output$HistoricalCatchMap <- 
  renderPlot( MapCatchesBySpp(filter(dat_sp_catch_by_spp, Species == input$selectedSpp ))) %>% 
  bindCache(input$selectedSpp) %>% 
  bindEvent(input$submitP1, ignoreNULL = FALSE)
```

## Row {data-height=150}
### Time series

```{r}
fillCol(
 dygraphOutput("CatchTimeSeries", height = "100%") 
)

output$CatchTimeSeries <- 
  renderDygraph({
    # browser()
    plot_dat_spp_time <-
      dat_spp_time %>%
      filter(Species == input$selectedSpp) %>%
      select(-Species)
    dygraph(plot_dat_spp_time) %>% dyRangeSelector()
  }) %>% 
  bindCache(input$selectedSpp) %>% 
  bindEvent(input$submitP1, ignoreNULL = FALSE)
```

# Page

## Column {data-width=350}


### Chart B

```{r}
inputPanel(numericInput(
  "num1",
  "Input Between 1 and 50",
  value = 25,
  min = 1,
  max = 50,
  step = 5
))

renderGauge(
  gauge(
  input$num1,
  min = 1,
  max = 50
  ,
  sectors = gaugeSectors(
    success = c(1, 20),
    warning = c(21, 40),
    danger = c(41, 50),
    colors = c("green", "yellow", "red")
  ),
)
  
)
```

### Linking

You can link to a dashboard page with either of the following syntaxes:

[Page 2]

[Page Two](#page-2)

The second syntax is used when you want a custom name for the link 
(rather than just using the page title).

# Page 2 {data-orientation=rows data-navmenu="Menu B"}

## A new row


### Articles per Day

```{r}
articles <- 3
valueBox(articles, icon = "fa-pencil")
```

### Comments per Day

```{r}
comments <- 736
valueBox(comments, icon = "fa-comments")
```

### Spam per Day

```{r}
spam <- formatC(23456789,big.mark = " ",format = "f", digits = 0) 
valueBox(spam, 
         icon = "fa-trash",
         color = ifelse(spam > 10, "warning", "primary"),caption = "Spam")
```


## Row {.tabset .tabset-fade}


### Tips

No separar por comas los argumentos para cada Pagina, colunma/fila, o cuadro

### Layout

Incluye varios temas. Ver los temas dispobibles [aqu√≠](https://pkgs.rstudio.com/flexdashboard/articles/using.html#appearance).
Otros temas pueden romper los widgets.




# Page 3 {data-orientation=rows data-navmenu="Menu B"}

## Row {data-height=2}

### Chart D
```{r}
plot(1,1)
```

## second row page 3 {data-height=1}


### Chart E {data-width=3}

```{r}
plot(1,1)
```

### Chart F {data-width=1}

```{r}
plot(1,1)
```
